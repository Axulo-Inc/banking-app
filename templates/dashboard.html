<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Axizulo African Bank</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .account-info {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .action-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .transactions {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #2980b9;
        }
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Axizulo African Bank - Dashboard</h1>
            <a href="/" class="btn">Home</a>
        </div>
        
        <div class="account-info">
            <h2>Account Information</h2>
            <p><strong>Account Holder:</strong> {{ account.account_holder }}</p>
            <p><strong>Account Number:</strong> {{ account.account_number }}</p>
            <p><strong>Account Type:</strong> {{ account.__class__.__name__ }}</p>
            <p><strong>Balance:</strong> R{{ "%.2f"|format(account.balance) }}</p>
            {% if account.interest_rate %}
            <p><strong>Interest Rate:</strong> {{ account.interest_rate }}%</p>
            {% endif %}
            {% if account.overdraft_limit %}
            <p><strong>Overdraft Limit:</strong> R{{ "%.2f"|format(account.overdraft_limit) }}</p>
            {% endif %}
        </div>
        
        <div class="actions">
            <div class="action-card">
                <h3>Deposit Money</h3>
                <input type="number" id="depositAmount" placeholder="Amount (R)" step="0.01" min="0.01">
                <input type="text" id="depositDesc" placeholder="Description (optional)">
                <button class="btn" onclick="deposit()">Deposit</button>
                <div id="depositResult"></div>
            </div>
            
            <div class="action-card">
                <h3>Withdraw Money</h3>
                <input type="number" id="withdrawAmount" placeholder="Amount (R)" step="0.01" min="0.01">
                <input type="text" id="withdrawDesc" placeholder="Description (optional)">
                <button class="btn" onclick="withdraw()">Withdraw</button>
                <div id="withdrawResult"></div>
            </div>
            
            <div class="action-card">
                <h3>Transfer Funds</h3>
                <input type="text" id="toAccount" placeholder="Recipient Account Number">
                <input type="number" id="transferAmount" placeholder="Amount (R)" step="0.01" min="0.01">
                <button class="btn" onclick="transfer()">Transfer</button>
                <div id="transferResult"></div>
            </div>
            
            <div class="action-card">
                <h3>Account Actions</h3>
                <button class="btn" onclick="checkBalance()">Check Balance</button>
                <button class="btn" onclick="viewTransactionHistory()">View Full History</button>
                <div id="balanceResult"></div>
            </div>
        </div>
        
        <div class="transactions">
            <h3>Recent Transactions</h3>
            {% if transactions %}
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in transactions %}
                    <tr>
                        <td>{{ transaction.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ transaction.transaction_type.title() }}</td>
                        <td>R{{ "%.2f"|format(transaction.amount) }}</td>
                        <td>{{ transaction.description }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No transactions yet.</p>
            {% endif %}
        </div>
    </div>

    <script>
        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<p class="${isSuccess ? 'success' : 'error'}">${message}</p>`;
            setTimeout(() => {
                element.innerHTML = '';
                location.reload(); // Refresh to update balance and transactions
            }, 2000);
        }

        async function deposit() {
            const amount = document.getElementById('depositAmount').value;
            const description = document.getElementById('depositDesc').value || 'Deposit';
            
            const formData = new FormData();
            formData.append('amount', amount);
            formData.append('description', description);
            
            const response = await fetch('/deposit', { method: 'POST', body: formData });
            const result = await response.json();
            
            showResult('depositResult', result.message, result.success);
        }

        async function withdraw() {
            const amount = document.getElementById('withdrawAmount').value;
            const description = document.getElementById('withdrawDesc').value || 'Withdrawal';
            
            const formData = new FormData();
            formData.append('amount', amount);
            formData.append('description', description);
            
            const response = await fetch('/withdraw', { method: 'POST', body: formData });
            const result = await response.json();
            
            showResult('withdrawResult', result.message, result.success);
        }

        async function transfer() {
            const toAccount = document.getElementById('toAccount').value;
            const amount = document.getElementById('transferAmount').value;
            
            const formData = new FormData();
            formData.append('to_account', toAccount);
            formData.append('amount', amount);
            
            const response = await fetch('/transfer', { method: 'POST', body: formData });
            const result = await response.json();
            
            showResult('transferResult', result.message, result.success);
        }

        async function checkBalance() {
            const response = await fetch('/balance');
            const result = await response.json();
            
            if (result.success) {
                document.getElementById('balanceResult').innerHTML = 
                    `<p class="success">Current Balance: R${result.balance.toFixed(2)}</p>`;
            } else {
                document.getElementById('balanceResult').innerHTML = 
                    `<p class="error">${result.message}</p>`;
            }
        }

        async function viewTransactionHistory() {
            const response = await fetch('/transaction_history');
            const result = await response.json();
            
            if (result.success) {
                let historyHTML = '<h4>Full Transaction History</h4><table><tr><th>Date</th><th>Type</th><th>Amount</th><th>Description</th></tr>';
                result.transactions.forEach(t => {
                    historyHTML += `<tr><td>${t.timestamp}</td><td>${t.type}</td><td>R${parseFloat(t.amount).toFixed(2)}</td><td>${t.description}</td></tr>`;
                });
                historyHTML += '</table>';
                
                document.getElementById('balanceResult').innerHTML = historyHTML;
            } else {
                document.getElementById('balanceResult').innerHTML = 
                    `<p class="error">${result.message}</p>`;
            }
        }
    </script>
</body>
</html>